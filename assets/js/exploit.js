
var char_exploit;
var dr_device;

function light_on(){
  var buffer1 =[0xcc,0x23,0x33] ;
  writedata=Uint8Array.from(buffer1);
  char_exploit.writeValue(writedata);
}

function light_off(){
  var buffer1 =[0xcc,0x24,0x33] ;
  writedata=Uint8Array.from(buffer1);
  char_exploit.writeValue(writedata);
}

function color_red(){
  var buffer1 =[0x56,0xff,0x00,0x00,0x00,0xf0,0xaa] ;
  writedata=Uint8Array.from(buffer1);
  char_exploit.writeValue(writedata);
}

function color_green(){
  var buffer1 =[0x56,0x00,0xff,0x00,0x00,0xf0,0xaa] ;
  writedata=Uint8Array.from(buffer1);
  char_exploit.writeValue(writedata);
}

function color_blue(){
  var buffer1 =[0x56,0x00,0x00,0xff,0x00,0xf0,0xaa] ;
  writedata=Uint8Array.from(buffer1);
  char_exploit.writeValue(writedata);
}

function color_white(){
  var buffer1 =[0x56,0xff,0xff,0xff,0x00,0xf0,0xaa] ;
  writedata=Uint8Array.from(buffer1);
  char_exploit.writeValue(writedata);
}

function color_rainbow(){
  var buffer1 =[0xbb,0x25,0x05,0x44] ;
  writedata=Uint8Array.from(buffer1);
  char_exploit.writeValue(writedata);
}

function device_connect() {
    let serviceUuid = "0000ffe5-0000-1000-8000-00805f9b34fb";
    let characteristicUuid = "0000ffe9-0000-1000-8000-00805f9b34fb"

    navigator.bluetooth.requestDevice
        ({
            filters: [{ services: [serviceUuid] }]
            , optionalServices: [serviceUuid]
        })
        .then(device => {
          dr_device=device;
          return device.gatt.connect();
         })
        .then(server => { swal("Device connected","","success",{button: "Begin",});return server.getPrimaryService(serviceUuid); })
        .then(service => { return service.getCharacteristic(characteristicUuid); })
        .then(characteristic => { char_exploit=characteristic; })
        .catch(error => {
            console.log('Error! ' + error);
        });
}

function device_disconnect(){
  if (dr_device.gatt.connected)
  {
    dr_device.gatt.disconnect();
    swal("Device disconnected","","warning",{button: "End",});
  }
}
